<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Simple Player</title>
</head>
<style>
  html { font-family: Arial, sans-serif; }
  body { 
    padding-top: 700px;
    background-color: rgb(181, 192, 192);
    height: 1800px;
    width: 4500px;
  }
  h3 { color: rgb(80, 119, 133); margin: 3px auto; font-size: 21px;}
  p { margin: 7px auto; }
  input { 
    display: inline-block;
    margin: auto;
  }
  .playerContainer {
    margin: auto;
    text-align: center;
  }
  #video {
    display: block;
    width: 1280px;
    height: 720px;
    margin: auto;
    margin-top: 10px;
  }

  .emphasized {
    color:cadetblue;
    font-style: italic;
    font-weight: 700;
  }

  /*субтитры можно стилизовать через псевдоэлемент ::cue */
  /* ::cue {
    color: red;
    background-color: black;
    font: 1em sans-serif;
  } */
</style>
<body>
  <div class="playerContainer">
    <h3>HTML5 local video file player</h3>
    <p class="playerContainer__message">Chose two files. One with <span class="emphasized">.mp4</span> extensions another subtitles <span class="emphasized">.vtt</span></p>
    <input type="file" multiple/>
    <button class="playerContainer__hideControlsButton">HideControls</button>
    <video id="video" contrors autoplay>
      <track id="subTrack" src="" default>
    </video>
    <p>Last played file name: <span class="lastPlayedFile emphasized"></span></p>
  </div>
  <script>
    (function localFileVideoPlayer() {
      'use strict'
      const URL = window.URL || window.webkitURL;
      const videoNode = document.querySelector('video');
      const subTrackElem = document.querySelector('#subTrack');
      const message = document.querySelector('.playerContainer > .playerContainer__message');
      let lastPlayedFileHolder = document.querySelector('.lastPlayedFile');

      const playSelectedFile = function (event) {
        let videoFile;
        let subFile;
        setVideoInCenter('test');
        for (let i = 0; i < this.files.length; i++) {
          let canPlay = videoNode.canPlayType(this.files[i].type);
          if (canPlay === 'maybe') {
            videoFile = this.files[i];
            message.innerHTML = 'Now play: ' + videoFile.name;
            addPlayedFileNameLocalStorage(videoFile.name);
          }
          if (canPlay === '') { subFile = this.files[i]; }
          if (i > 1) { break }
        }

        const videoFileURL = URL.createObjectURL(videoFile);

        if (subFile) {
          const subFileURL = URL.createObjectURL(subFile);
          subTrackElem.setAttribute('src', subFileURL);
        }
        videoNode.src = videoFileURL;
      }
      const inputNode = document.querySelector('input');
      inputNode.addEventListener('change', playSelectedFile, false);

      function pauseByClick(event) {
        if (event.target.tagName === 'VIDEO') {
          const video = event.target;
          const paused = video.paused;
          if (!paused) {
            video.pause();
          } else {
            video.play();
          }
        }
      }

      function handleKeyDown(event) {
        event.preventDefault();
        switch(event.code) {
          case 'Space':
            const paused = videoNode.paused;
            if (!paused) {
              videoNode.pause();
            } else {
              videoNode.play();
            }
          break;
          case 'ArrowRight':
            videoNode.currentTime = videoNode.currentTime + 4;
          break;
          case 'ArrowLeft':
            videoNode.currentTime = videoNode.currentTime - 4;
          break;
          default:
            return null
        }
      }
      videoNode.addEventListener('click', pauseByClick, false);
      document.addEventListener('keydown', handleKeyDown, false);

      function setVideoInCenter() {
        /* Нужно вычислить серидину окна браузера и с учетом этих координат 
        проскроллить горизонтальную и вертикальную прокрутки после загрузки страницы
        чтобы видео-фрейм оказался в середине экрана.
        Но пока что просто прокручиваем видео в цент относительно документа. 
        */

        /* Вызов через setTimeout для того, чтобы функция scrollTo вызывалась после того как применятся css стили */
        setTimeout(() => { window.scrollTo(1400, 700) }, 0)
      }
      window.onload = setVideoInCenter();

      // скрыть(показать) элементы управления
      const showControlsButton = document.querySelector(".playerContainer__hideControlsButton");
      function hideControlsButtonHandle() {
        if(!videoNode.controls) {
          videoNode.controls = true;
          showControlsButton.innerHTML = "HideControls";
        } else {
          videoNode.controls = false;
          showControlsButton.innerHTML = "ShowControls";
        }
      }
      showControlsButton.addEventListener('click', hideControlsButtonHandle);

      // [TO DO] Добавить сохранение названия последнего загруженного видео в localStorag браузера.
      function showLastPlayedFile() {
        let lastPlayedFile = window.localStorage.getItem('lastPlayedFile');
        if (lastPlayedFile) {
          lastPlayedFileHolder.innerHTML = lastPlayedFile;
        }
      }
      window.addEventListener('load', showLastPlayedFile);
      function addPlayedFileNameLocalStorage(fileName) {
        window.localStorage.setItem('lastPlayedFile', fileName);
      }
    })()
  </script>
</body>
</html>